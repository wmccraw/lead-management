<!DOCTYPE html>
     <html lang="en">
     <head>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <title>Lead Management System</title>
       <style>
         body {
           font-family: Arial, sans-serif;
           margin: 0;
           padding: 0;
           background-color: #f4f4f4;
         }
         .tab-container {
           display: flex;
           justify-content: center;
           background-color: #007BFF;
           padding: 10px 0;
           margin-bottom: 20px;
         }
         .tab-button {
           background-color: #007BFF;
           color: white;
           border: none;
           padding: 10px 20px;
           margin: 0 10px;
           cursor: pointer;
           font-size: 16px;
           transition: background-color 0.3s;
         }
         .tab-button:hover {
           background-color: #0056b3;
         }
         .tab-button.active {
           background-color: #0056b3;
         }
         .table-container, .card-container {
           padding: 20px;
           max-width: 1280px;
           margin: 0 auto;
         }
         table {
           width: 100%;
           border-collapse: collapse;
           background-color: white;
           box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
         }
         th, td {
           padding: 12px;
           text-align: left;
           border-bottom: 1px solid #ddd;
         }
         th {
           background-color: #007BFF;
           color: white;
         }
         td {
           color: #333;
         }
         tr:nth-child(even) {
           background-color: #f9f9f9;
         }
         tr:hover {
           background-color: #f1f1f1;
         }
         .id-column {
           width: 3%;
         }
         .email-column {
           width: 12%;
         }
         .notes-column {
           width: 18%;
         }
         button {
           background-color: #007BFF;
           color: white;
           border: none;
           padding: 8px 16px;
           cursor: pointer;
           transition: background-color 0.3s;
         }
         button:hover {
           background-color: #0056b3;
         }
         .modal {
           display: none;
           position: fixed;
           top: 50%;
           left: 50%;
           transform: translate(-50%, -50%);
           background-color: white;
           padding: 20px;
           box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
           z-index: 1000;
           max-width: 500px;
           width: 90%;
         }
         .modal-content label {
           display: block;
           margin: 10px 0 5px;
         }
         .modal-content input, .modal-content select, .modal-content textarea {
           width: 100%;
           padding: 8px;
           margin-bottom: 10px;
         }
         .close {
           float: right;
           font-size: 20px;
           cursor: pointer;
         }
         .card-container {
           display: none;
           gap: 1.5rem;
           flex-wrap: wrap;
         }
         .card {
           background-color: white;
           border: 1px solid #ddd;
           box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
           padding: 15px;
           width: calc(33.33% - 1rem);
           box-sizing: border-box;
           cursor: pointer;
           transition: transform 0.2s;
         }
         .card:hover {
           transform: scale(1.02);
         }
         .card.expanded {
           width: 100%;
           max-width: 600px;
         }
         .card h3 {
           margin: 0 0 10px;
           color: #007BFF;
         }
         .card p {
           margin: 5px 0;
           white-space: pre-wrap;
         }
         @media (max-width: 768px) {
           .card {
             width: calc(50% - 1rem);
           }
           .card.expanded {
             width: 90%;
           }
         }
         @media (max-width: 480px) {
           .card {
             width: 100%;
           }
         }
         .overlay {
           display: none;
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background-color: rgba(0, 0, 0, 0.5);
           z-index: 999;
         }
       </style>
     </head>
     <body>
       <div class="tab-container">
         <button class="tab-button active" onclick="openTab('leads')">Leads</button>
         <button class="tab-button" onclick="openTab('customers')">Customers</button>
       </div>

       <div id="leads-tab" class="table-container">
         <table>
           <thead>
             <tr>
               <th class="id-column">ID</th>
               <th>Customer Name</th>
               <th class="email-column">Email</th>
               <th>Phone</th>
               <th>Street</th>
               <th>City</th>
               <th>State</th>
               <th>Zip</th>
               <th>Categories</th>
               <th>Make</th>
               <th>Model</th>
               <th class="notes-column">Notes</th>
               <th>Status</th>
               <th>Time in System</th>
               <th>Date Added</th>
               <th>Actions</th>
             </tr>
           </thead>
           <tbody id="leads-table"></tbody>
         </table>
         <button onclick="openAddLeadModal()">Add Lead</button>
       </div>

       <div id="customers-tab" class="table-container" style="display: none;">
         <table>
           <thead>
             <tr>
               <th class="id-column">ID</th>
               <th>Customer Name</th>
               <th>Email</th>
               <th>Phone</th>
               <th>Street</th>
               <th>City</th>
               <th>State</th>
               <th>Zip</th>
               <th>Actions</th>
             </tr>
           </thead>
           <tbody id="customers-table"></tbody>
         </table>
         <button onclick="openAddCustomerModal()">Add Customer</button>
       </div>

       <div id="leads-cards" class="card-container"></div>
       <div id="customers-cards" class="card-container" style="display: none;"></div>

       <div id="overlay" class="overlay" onclick="closeModal()"></div>
       <div id="add-lead-modal" class="modal">
         <span class="close" onclick="closeModal()">×</span>
         <div class="modal-content">
           <h2>Add Lead</h2>
           <label>Customer Name:</label><input type="text" id="add-customer-name">
           <label>Company:</label><input type="text" id="add-company">
           <label>Email:</label><input type="email" id="add-email">
           <label>Phone:</label><input type="text" id="add-phone">
           <label>Street:</label><input type="text" id="add-street">
           <label>City:</label><input type="text" id="add-city">
           <label>State:</label><input type="text" id="add-state">
           <label>Zip:</label><input type="text" id="add-zip">
           <label>Categories:</label><input type="text" id="add-categories">
           <label>Make:</label><input type="text" id="add-make">
           <label>Model:</label><input type="text" id="add-model">
           <label>Notes:</label><textarea id="add-notes"></textarea>
           <label>Status:</label>
           <select id="add-status">
             <option value="New">New</option>
             <option value="Quoted">Quoted</option>
             <option value="Pending">Pending</option>
             <option value="Closed">Closed</option>
           </select>
           <button onclick="addLead()">Add Lead</button>
         </div>
       </div>

       <div id="edit-lead-modal" class="modal">
         <span class="close" onclick="closeModal()">×</span>
         <div class="modal-content">
           <h2>Edit Lead</h2>
           <input type="hidden" id="edit-id">
           <label>Customer Name:</label><input type="text" id="edit-customer-name">
           <label>Company:</label><input type="text" id="edit-company">
           <label>Email:</label><input type="email" id="edit-email">
           <label>Phone:</label><input type="text" id="edit-phone">
           <label>Street:</label><input type="text" id="edit-street">
           <label>City:</label><input type="text" id="edit-city">
           <label>State:</label><input type="text" id="edit-state">
           <label>Zip:</label><input type="text" id="edit-zip">
           <label>Categories:</label><input type="text" id="edit-categories">
           <label>Make:</label><input type="text" id="edit-make">
           <label>Model:</label><input type="text" id="edit-model">
           <label>Notes:</label><textarea id="edit-notes"></textarea>
           <label>Status:</label>
           <select id="edit-status">
             <option value="New">New</option>
             <option value="Quoted">Quoted</option>
             <option value="Pending">Pending</option>
             <option value="Closed">Closed</option>
           </select>
           <button onclick="updateLead()">Update Lead</button>
         </div>
       </div>

       <div id="add-customer-modal" class="modal">
         <span class="close" onclick="closeModal()">×</span>
         <div class="modal-content">
           <h2>Add Customer</h2>
           <label>Customer Name:</label><input type="text" id="add-customer-name-c">
           <label>Company:</label><input type="text" id="add-company-c">
           <label>Email:</label><input type="email" id="add-email-c">
           <label>Phone:</label><input type="text" id="add-phone-c">
           <label>Street:</label><input type="text" id="add-street-c">
           <label>City:</label><input type="text" id="add-city-c">
           <label>State:</label><input type="text" id="add-state-c">
           <label>Zip:</label><input type="text" id="add-zip-c">
           <button onclick="addCustomer()">Add Customer</button>
         </div>
       </div>

       <div id="edit-customer-modal" class="modal">
         <span class="close" onclick="closeModal()">×</span>
         <div class="modal-content">
           <h2>Edit Customer</h2>
           <input type="hidden" id="edit-id-c">
           <label>Customer Name:</label><input type="text" id="edit-customer-name-c">
           <label>Company:</label><input type="text" id="edit-company-c">
           <label>Email:</label><input type="email" id="edit-email-c">
           <label>Phone:</label><input type="text" id="edit-phone-c">
           <label>Street:</label><input type="text" id="edit-street-c">
           <label>City:</label><input type="text" id="edit-city-c">
           <label>State:</label><input type="text" id="edit-state-c">
           <label>Zip:</label><input type="text" id="edit-zip-c">
           <button onclick="updateCustomer()">Update Customer</button>
         </div>
       </div>

       <script>
         async function fetchData(endpoint, tableId, cardId) {
           const response = await fetch(`https://lead-management-system-f6v2.onrender.com/api/${endpoint}`);
           const data = await response.json();
           const table = document.getElementById(tableId);
           const cards = document.getElementById(cardId);
           table.innerHTML = '';
           cards.innerHTML = '';
           data.forEach(item => {
             const row = document.createElement('tr');
             row.innerHTML = `
               <td class="id-column">${item.id}</td>
               <td>${item.customer_name}</td>
               <td class="email-column">${item.customer_email || ''}</td>
               <td>${item.customer_phone || ''}</td>
               <td>${item.customer_street || ''}</td>
               <td>${item.customer_city || ''}</td>
               <td>${item.customer_state || ''}</td>
               <td>${item.customer_zip || ''}</td>
               ${endpoint === 'leads' ? `
                 <td>${item.categories || ''}</td>
                 <td>${item.make || ''}</td>
                 <td>${item.model || ''}</td>
                 <td class="notes-column">${item.machines_notes || ''}</td>
                 <td>${item.status || ''}</td>
                 <td>${calculateTimeInSystem(item.created_at)}</td>
                 <td>${new Date(item.created_at).toLocaleDateString()}</td>
                 <td>
                   <button onclick="openEditModal('lead', ${item.id})">Edit</button>
                   <button onclick="deleteItem('leads', ${item.id})">Delete</button>
                 </td>
               ` : `
                 <td>
                   <button onclick="openEditModal('customer', ${item.id})">Edit</button>
                   <button onclick="deleteItem('customers', ${item.id})">Delete</button>
                 </td>
               `}
             `;
             table.appendChild(row);

             const card = document.createElement('div');
             card.className = 'card';
             card.innerHTML = `
               <h3>Customer Name: ${item.customer_name}</h3>
               <p>Email: ${item.customer_email || 'N/A'}</p>
               <p>Phone: ${item.customer_phone || 'N/A'}</p>
               <p>Street: ${item.customer_street || 'N/A'}</p>
               <p>City: ${item.customer_city || 'N/A'}</p>
               <p>State: ${item.customer_state || 'N/A'}</p>
               <p>Zip: ${item.customer_zip || 'N/A'}</p>
               ${endpoint === 'leads' ? `
                 <p>Categories: ${item.categories || 'N/A'}</p>
                 <p>Make: ${item.make || 'N/A'}</p>
                 <p>Model: ${item.model || 'N/A'}</p>
                 <p>Notes: ${item.machines_notes || 'N/A'}</p>
                 <p>Status: ${item.status || 'N/A'}</p>
                 <p>Time in System: ${calculateTimeInSystem(item.created_at)}</p>
                 <p>Date Added: ${new Date(item.created_at).toLocaleDateString()}</p>
               ` : ''}
             `;
             card.onclick = () => toggleCard(card);
             cards.appendChild(card);
           });
         }

         function calculateTimeInSystem(createdAt) {
           const now = new Date();
           const created = new Date(createdAt);
           const diffMs = now - created;
           const diffHrs = Math.floor(diffMs / (1000 * 60 * 60));
           return `${diffHrs} hours`;
         }

         function openTab(tabName) {
           document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
           document.querySelectorAll('.table-container, .card-container').forEach(el => el.style.display = 'none');
           document.getElementById(`${tabName}-tab`).style.display = 'block';
           document.getElementById(`${tabName}-cards`).style.display = 'flex';
           document.querySelector(`[onclick="openTab('${tabName}')"]`).classList.add('active');
           fetchData(tabName, `${tabName}-table`, `${tabName}-cards`);
         }

         function toggleCard(card) {
           card.classList.toggle('expanded');
           document.getElementById('overlay').style.display = card.classList.contains('expanded') ? 'block' : 'none';
         }

         function openModal(modalId) {
           document.getElementById(modalId).style.display = 'block';
           document.getElementById('overlay').style.display = 'block';
         }

         function closeModal() {
           document.querySelectorAll('.modal').forEach(modal => modal.style.display = 'none');
           document.getElementById('overlay').style.display = 'none';
         }

         function openAddLeadModal() { openModal('add-lead-modal'); }
         function openAddCustomerModal() { openModal('add-customer-modal'); }

         function openEditModal(type, id) {
           fetch(`https://lead-management-system-f6v2.onrender.com/api/${type}/${id}`)
             .then(response => response.json())
             .then(data => {
               const modal = document.getElementById(`edit-${type}-modal`);
               Object.keys(data).forEach(key => {
                 const input = modal.querySelector(`#edit-${key.replace(/_/g, '-')}`);
                 if (input) input.value = data[key] || '';
               });
               modal.querySelector('#edit-id').value = id;
               openModal(`edit-${type}-modal`);
             });
         }

         function addLead() {
           const data = {
             customerName: document.getElementById('add-customer-name').value,
             company: document.getElementById('add-company').value,
             customerEmail: document.getElementById('add-email').value,
             customerPhone: document.getElementById('add-phone').value,
             customerStreet: document.getElementById('add-street').value,
             customerCity: document.getElementById('add-city').value,
             customerState: document.getElementById('add-state').value,
             customerZip: document.getElementById('add-zip').value,
             categories: document.getElementById('add-categories').value,
             make: document.getElementById('add-make').value,
             model: document.getElementById('add-model').value,
             machinesNotes: document.getElementById('add-notes').value,
             status: document.getElementById('add-status').value
           };
           fetch('https://lead-management-system-f6v2.onrender.com/api/leads', {
             method: 'POST',
             headers: { 'Content-Type': 'application/json' },
             body: JSON.stringify(data)
           }).then(() => {
             closeModal();
             fetchData('leads', 'leads-table', 'leads-cards');
           }).catch(err => alert('Error creating lead: ' + err));
         }

         function updateLead() {
           const id = document.getElementById('edit-id').value;
           const data = {
             customerName: document.getElementById('edit-customer-name').value,
             company: document.getElementById('edit-company').value,
             customerEmail: document.getElementById('edit-email').value,
             customerPhone: document.getElementById('edit-phone').value,
             customerStreet: document.getElementById('edit-street').value,
             customerCity: document.getElementById('edit-city').value,
             customerState: document.getElementById('edit-state').value,
             customerZip: document.getElementById('edit-zip').value,
             categories: document.getElementById('edit-categories').value,
             make: document.getElementById('edit-make').value,
             model: document.getElementById('edit-model').value,
             machinesNotes: document.getElementById('edit-notes').value,
             status: document.getElementById('edit-status').value
           };
           fetch(`https://lead-management-system-f6v2.onrender.com/api/leads/${id}`, {
             method: 'PUT',
             headers: { 'Content-Type': 'application/json' },
             body: JSON.stringify(data)
           }).then(() => {
             closeModal();
             fetchData('leads', 'leads-table', 'leads-cards');
           }).catch(err => alert('Error updating lead: ' + err));
         }

         function addCustomer() {
           const data = {
             customerName: document.getElementById('add-customer-name-c').value,
             company: document.getElementById('add-company-c').value,
             customerEmail: document.getElementById('add-email-c').value,
             customerPhone: document.getElementById('add-phone-c').value,
             customerStreet: document.getElementById('add-street-c').value,
             customerCity: document.getElementById('add-city-c').value,
             customerState: document.getElementById('add-state-c').value,
             customerZip: document.getElementById('add-zip-c').value
           };
           fetch('https://lead-management-system-f6v2.onrender.com/api/customers', {
             method: 'POST',
             headers: { 'Content-Type': 'application/json' },
             body: JSON.stringify(data)
           }).then(() => {
             closeModal();
             fetchData('customers', 'customers-table', 'customers-cards');
           }).catch(err => alert('Error creating customer: ' + err));
         }

         function updateCustomer() {
           const id = document.getElementById('edit-id-c').value;
           const data = {
             customerName: document.getElementById('edit-customer-name-c').value,
             company: document.getElementById('edit-company-c').value,
             customerEmail: document.getElementById('edit-email-c').value,
             customerPhone: document.getElementById('edit-phone-c').value,
             customerStreet: document.getElementById('edit-street-c').value,
             customerCity: document.getElementById('edit-city-c').value,
             customerState: document.getElementById('edit-state-c').value,
             customerZip: document.getElementById('edit-zip-c').value
           };
           fetch(`https://lead-management-system-f6v2.onrender.com/api/customers/${id}`, {
             method: 'PUT',
             headers: { 'Content-Type': 'application/json' },
             body: JSON.stringify(data)
           }).then(() => {
             closeModal();
             fetchData('customers', 'customers-table', 'customers-cards');
           }).catch(err => alert('Error updating customer: ' + err));
         }

         function deleteItem(endpoint, id) {
           if (confirm('Are you sure you want to delete this item?')) {
             fetch(`https://lead-management-system-f6v2.onrender.com/api/${endpoint}/${id}`, {
               method: 'DELETE'
             }).then(() => fetchData(endpoint, `${endpoint}-table`, `${endpoint}-cards`))
               .catch(err => alert('Error deleting item: ' + err));
           }
         }

         window.onload = () => openTab('leads');
       </script>
     </body>
     </html>